@using Tilework.LoadBalancing.Enums
@using Tilework.LoadBalancing.Models
@using Tilework.Core.Enums
@using System.Collections.Generic

@namespace Tilework.Ui.Components.Forms

<MudPaper Class="mb-4 p-4" Outlined="true">
    <MudStack Spacing="1" Class="ma-1" StretchItems="StretchItems.Start" Row>
        <MudText Typo="Typo.subtitle2">@Condition.Type.GetDescription()</MudText>
        <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" Variant="Variant.Text" Size="Size.Small" OnClick="OnDelete" />
    </MudStack>
    <MudDivider/>
    <MudStack Spacing="1" Class="ma-2">
        @for (var i = 0; i < Condition.Values.Count; i++)
        {
            var index = i;
            <MudStack StretchItems="StretchItems.Start" Row>
                <MudTextField @bind-Value="Condition.Values[index]" Label="Value" Variant="Variant.Outlined" Required="true" Margin="Margin.Dense" />
                <MudIconButton Icon="@Icons.Material.Filled.Delete" Variant="Variant.Text" Size="Size.Small" OnClick="@(() => RemoveValue(index))" />
            </MudStack>
        }
        <MudStack AlignItems="AlignItems.Start" Row>
            <MudButton Size="Size.Small" Variant="Variant.Text" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" OnClick="AddValue">
                Add OR condition value
            </MudButton>
        </MudStack>
    </MudStack>
</MudPaper>

@code {
    [Parameter] public Condition Condition { get; set; }
    [Parameter] public EventCallback OnDelete { get; set; }

    protected override void OnParametersSet()
    {
        if (Condition?.Values == null || Condition.Values.Count == 0)
        {
            Condition.Values ??= new List<string>();
            Condition.Values.Add(string.Empty);
        }
    }

    void AddValue()
    {
        Condition.Values.Add(string.Empty);
    }

    void RemoveValue(int index)
    {
        if (index >= 0 && index < Condition.Values.Count)
        {
            Condition.Values.RemoveAt(index);
            if (Condition.Values.Count == 0)
            {
                Condition.Values.Add(string.Empty);
            }
        }
    }
}
