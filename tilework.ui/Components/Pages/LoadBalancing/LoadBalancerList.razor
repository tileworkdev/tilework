@using Tilework.LoadBalancing.Models
@using Tilework.LoadBalancing.Interfaces

@namespace Tilework.Ui.Components.Pages
@inject ILoadBalancerService _loadBalancerService


@page "/lb/loadbalancers"

<PageTitle>Load balancers</PageTitle>

<GenericListview Title="Load balancers" Items="@_items" Actions="@_actions" Breadcrumbs="@_breadcrumbs">
    <HeaderContent>
        <MudTh>Name</MudTh>
        <MudTh>Port</MudTh>
        <MudTh>Type</MudTh>
        <MudTh>Protocol</MudTh>
        <MudTh>Status</MudTh>
    </HeaderContent>
    <RowContent>
        <MudTd DataLabel="Name"><MudLink Href="@($"/lb/loadbalancers/{context.Id}")">@context.Name</MudLink></MudTd>
        <MudTd DataLabel="Port">@context.Port</MudTd>
        <MudTd DataLabel="Type">@(context is ApplicationLoadBalancerDTO ? "Application" : "Network")</MudTd>
        <MudTd DataLabel="Protocol">
            @(context is ApplicationLoadBalancerDTO ? ((ApplicationLoadBalancerDTO) context).Protocol : ((NetworkLoadBalancerDTO) context).Protocol)
        </MudTd>
        <MudTd DataLabel="Status">
            @if (context.Enabled)
            {
                <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center">
                    <MudIcon Style="@($"color:{Colors.Green.Darken2};")"  Icon="@Icons.Material.Outlined.CheckCircle" Size="Size.Small"/>
                    <MudText Style="@($"color:{Colors.Green.Darken2};")" Typo="Typo.body2">Enabled</MudText>
                </MudStack>
            }
            else
            {
                <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center">
                    <MudIcon Style="@($"color:{Colors.Gray.Darken1};")" Icon="@Icons.Material.Outlined.StopCircle" Size="Size.Small"/>
                    <MudText Style="@($"color:{Colors.Gray.Darken1};")" Typo="Typo.body2">Disabled</MudText>
                </MudStack>
            }
        </MudTd>
    </RowContent>
</GenericListview>

@code {
    public List<BaseLoadBalancerDTO> _items { get; set; } = new();

    private List<BreadcrumbItem> _breadcrumbs = new List<BreadcrumbItem>
    {
        new BreadcrumbItem("Home", href: "/", icon: Icons.Material.Filled.Home),
        new BreadcrumbItem("Load balancers", href: "/lb/loadbalancers/", disabled: true, icon: Icons.Material.Filled.AltRoute),
    };

    private List<ActionItem> _actions = new List<ActionItem>
    {
        new ActionItem { Name = "Create new", Href = "/lb/loadbalancers/new" }
    };

    protected override async Task OnInitializedAsync()
    {
        _items = await _loadBalancerService.GetLoadBalancers();
    }
}    
