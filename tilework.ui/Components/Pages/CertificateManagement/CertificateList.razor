@using Tilework.Core.CertificateManagement.Models
@using Tilework.Core.Interfaces
@using Tilework.Core.Enums

@namespace Tilework.Ui.Components.Pages

@inject ICertificateManagementService _certificateManagementService
@inject NavigationManager _navigationManager


@page "/cm/certificates"

<GenericListview Title="Certificates" Items="@_items" Actions="@_actions" Breadcrumbs="@_breadcrumbs">
    <HeaderContent>
        <MudTh>Name</MudTh>
        <MudTh>FQDN</MudTh>
        <MudTh>Status</MudTh>
        <MudTh>Key algorithm</MudTh>
        <MudTh>Expiration</MudTh>
        <MudTh>CA</MudTh>
    </HeaderContent>
    <RowContent>
        <MudTd DataLabel="Name"><MudLink Href="@($"/cm/certificates/{context.Id}")">@context.Name</MudLink></MudTd>
        <MudTd DataLabel="FQDN">@context.Fqdn</MudTd>
        <MudTd DataLabel="Status">@context.Status</MudTd>
        <MudTd DataLabel="Key algorithm">@_certificateManagementService.GetPrivateKey(context.PrivateKey).Result?.Algorithm.GetDescription()</MudTd>
        <MudTd DataLabel="Expiration">@context.ExpiresAtUtc</MudTd>
        <MudTd DataLabel="CA">@_certificateManagementService.GeCertificateAuthority(context.Authority).Result?.Name</MudTd>
    </RowContent>
</GenericListview>

@code {
    public List<CertificateDTO> _items { get; set; } = new();

    private List<BreadcrumbItem> _breadcrumbs = new List<BreadcrumbItem>
    {
        new BreadcrumbItem("Home", href: "/", icon: Icons.Material.Filled.Home),
        new BreadcrumbItem("Certificates", href: "/cm/certificates/", disabled: true, icon: Icons.Material.Filled.AltRoute),
    };

    private List<ActionItem> _actions = new List<ActionItem>
    {
        new ActionItem { Name = "Create new", Href = "/cm/certificates/new" }
    };

    protected override async Task OnInitializedAsync()
    {
        _items = await _certificateManagementService.GetCertificates();
    }
}    
